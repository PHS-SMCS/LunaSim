<!DOCTYPE html>
<!---
  Authors: Sienna Simms, Karthik S. Vedula, Aditya Patil, William J. Park
-->

<html lang="en">
<head>
  <title>LunaSim</title>
  <meta id="vp" name="viewport" content="width=device-width">
  <meta name="description" content="Design and run powerful simulations, all in the browser with LunaSim.">
  <script>
    // set the viewport width to no less than minimum
    window.onload = function () {
      if (screen.width < 600) {
        var mvp = document.getElementById('vp');
        mvp.setAttribute('content', 'minimum-scale=1,width=600');
      }
    }
  </script>
  <!-- style sheets -->
  <link rel="stylesheet" href="simulation2.css" id="lightThemeCSS">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="icon" href="../img/lunaLogo.svg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css">
  <link rel="stylesheet" data-purpose="Layout StyleSheet" href="/css/app-wa-4605c815f1874757bc9ac33aa114fb0f.css?vsn=d">
</head>
<body>
  <script src="https://unpkg.com/gojs@2.3.3/release/go.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
  <div id="allSampleContent" class="p-4 w-full">
    <script src="https://unpkg.com/gojs@2.3.3/extensions/Figures.js"></script>
    <script src="https://unpkg.com/gojs@2.3.3/extensions/NodeLabelDraggingTool.js"></script>
  <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator.min.css" rel="stylesheet">
  <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>
  <!-- Override CSS w/ Dark Mode Theme -->
  <link rel="stylesheet" href="simulation_dark.css" disabled="disabled" id="darkThemeCSS">
  
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script id="code" type="module" src="editor.js"></script>
    <script id="code2" type="module" src="translator.js"></script>
    <script id="code3" type="module" src="engine.js"></script>
    <script id="code4" type="module" src="tabsManagement.js"></script>
    
    <div id="sample">
      <div class="projectActions">
        <div class="projectStatus">
          <div class="statusLine">No Unsaved Edits (Last Edit: 19m ago)</div>
          <div class="statusLine">Last Exported: -</div>
        </div>

        <button class="actionButton" id="runButton"><i class="fa-regular fa-play"></i></button>
        <button class="actionButton" id="importButton"><i class="fa-regular fa-file-import"></i></button>
        <button class="actionButton" id="exportButton"><i class="fa-regular fa-file-export"></i></button>
        <button class="actionButton" id="clearButton"><i class="fa-regular fa-trash"></i></button>
      </div>

      <input class="projectNameInput" type="text" placeholder="Project Name" value="New Project" />

      <img id="logoImage" src="../img/lunaLogo.svg" alt="LunaSim Logo" />
      

      <div class="tabBar">
          <button class="tabButton" id="modelBtn">Model View</button>
          <button class="tabButton" id="chartBtn" onclick="openChartTab()">Charts/Tables</button>        
      </div>
      <div class="modelViewer">
        <!-- Tool Bar -->
        <div class="toolbar">
          <ul>
            <li>
              <a href="#">
                <i class="fa-regular fa-arrow-pointer"></i>
                <span>Pointer</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa-regular fa-rectangle"></i>
                <span>Stock</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa-regular fa-cloud"></i>
                <span>Cloud</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa-regular fa-circle"></i>
                <span>Variable</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa-regular fa-arrows-left-right"></i>
                <span>Flow</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa-regular fa-repeat"></i>
                <span>Influence</span>
              </a>
            </li>
            <li>  
              <a href="../UserDocs.html" class="no-active">
                <i class="fa-regular fa-question"></i>
                <span>Help</span>
              </a>
            </li>
            <li>
              <a href="#" id="openSettingsBtn" class="no-active">
                <i class="fa-regular fa-gear"></i>
                <span>Settings</span>
              </a>
            </li>
          </ul>
        </div>


        <div class="modelCanvas" id="modalView">
          <div id="myDiagram">
            <canvas width="800" height="498">This text is displayed if your browser does not support the Canvas HTML
              element.</canvas>
          </div>
        </div>


        <div class="equationEditor">
          <div class="equation-editor-header">
            <p class="equation-editor-title">Equation Editor</p>
            <i class="fa-solid fa-up-right-and-down-left-from-center equation-editor-zoom-icon" onclick="openEquationEditorPopup()"></i>
          </div>
          <table class="equation-editor-table">
            <thead>
              <tr>
                <th class="eq-col-type">Type</th>
                <th class="eq-col-name">Name</th>
                <th class="eq-col-equation">Equation</th>
                <th class="eq-col-checkbox">NN/Uni</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><input type="text" class="equation-editor-input" placeholder="type" value="stock" style="border: 1px solid #847640;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="name" value="stock1" style="border: 1px solid #847640;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="equation" style="border: 1px solid #847640;"></td>
                <td class="eq-checkbox-cell">
                  <input type="checkbox" class="equation-editor-checkbox" />
                </td>
              </tr>
              <tr>
                <td><input type="text" class="equation-editor-input" placeholder="type" value="flow"></td>
                <td><input type="text" class="equation-editor-input" placeholder="name" value="flow1"></td>
                <td><input type="text" class="equation-editor-input" placeholder="equation"></td>
                <td class="eq-checkbox-cell">
                  <input type="checkbox" class="equation-editor-checkbox" />
                </td>
              </tr>
              <tr>
                <td><input type="text" class="equation-editor-input" placeholder="type" value="variable" style="border: 1px solid #3b773d;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="name" value="variable1" style="border: 1px solid #3b773d;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="equation" style="border: 1px solid #3b773d;"></td>
                <td class="eq-checkbox-cell">
                  <input type="checkbox" class="equation-editor-checkbox" />
                </td>
              </tr>
              <tr>
                <td><input type="text" class="equation-editor-input" placeholder="type" value="stock" style="border: 1px solid #847640;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="name" value="stock2" style="border: 1px solid #847640;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="equation" style="border: 1px solid #847640;"></td>
                <td class="eq-checkbox-cell">
                  <input type="checkbox" class="equation-editor-checkbox" />
                </td>
              </tr>
              <tr>
                <td><input type="text" class="equation-editor-input" placeholder="type" value="stock" style="border: 1px solid #847640;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="name" value="stock3" style="border: 1px solid #847640;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="equation" style="border: 1px solid #847640;"></td>
                <td class="eq-checkbox-cell">
                  <input type="checkbox" class="equation-editor-checkbox" />
                </td>
              </tr>
              <tr>
                <td><input type="text" class="equation-editor-input" placeholder="type" value="flow"></td>
                <td><input type="text" class="equation-editor-input" placeholder="name" value="flow2"></td>
                <td><input type="text" class="equation-editor-input" placeholder="equation"></td>
                <td class="eq-checkbox-cell">
                  <input type="checkbox" class="equation-editor-checkbox" />
                </td>
              </tr>
              <tr>
                <td><input type="text" class="equation-editor-input" placeholder="type" value="variable" style="border: 1px solid #3b773d;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="name" value="variable2" style="border: 1px solid #3b773d;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="equation" style="border: 1px solid #3b773d;"></td>
                <td class="eq-checkbox-cell">
                  <input type="checkbox" class="equation-editor-checkbox" />
                </td>
              </tr>
              <tr>
                <td><input type="text" class="equation-editor-input" placeholder="type" value="variable" style="border: 1px solid #3b773d;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="name" value="variable3" style="border: 1px solid #3b773d;"></td>
                <td><input type="text" class="equation-editor-input" placeholder="equation" style="border: 1px solid #3b773d;"></td>
                <td class="eq-checkbox-cell">
                  <input type="checkbox" class="equation-editor-checkbox" />
                </td>
              </tr>
              
            </tbody>
          </table>
        </div>
      </div>

      <div class="chartViewer">
        <!-- Tool Bar -->
        <div class="chartSidebar">
          <ul>
            <li>
              <a href="#">
                <i class="fa-regular fa-chart-sine"></i>
                <span>Chart1</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa-regular fa-chart-sine"></i>
                <span>Chart2</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa-regular fa-table"></i>
                <span>Table1</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa-regular fa-table"></i>
                <span>Table2</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa-regular fa-chart-scatter"></i>
                <span>Chart3</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fa-regular fa-table"></i>
                <span>Table3</span>
              </a>
            </li>
            <li>  
              <a href="../UserDocs.html" class="no-active">
                <i class="fa-regular fa-question"></i>
                <span>Help</span>
              </a>
            </li>
            <li>
              <a href="#" id="openSettingsBtn2" class="no-active">
                <i class="fa-regular fa-gear"></i>
                <span>Settings</span>
              </a>
            </li>
          </ul>
        </div>


        <div class="chartCanvas">
          
        </div>


        <div class="chartEditor">
          <!-- Content for your new box -->
          <p>Chart Editor Goes Here</p>
        </div>
      </div>

      <div id="overlay" class="overlay hidden" onclick="closeSettings()"></div>

      <div id="settingsPopup" class="settings-popup hidden">
        <div class="settings-header">
          <h2>Simulation Settings</h2>
          <button class="close-btn" onclick="closeSettings()"><i class="fa-regular fa-xmark"></i></button>
        </div>
        <div class="setting-group">

          <label for="simParams" class="dotted-underline">Start Time</label>
          <input type="text" id="simParams" class="settings-input" placeholder="Enter start time..." value="0" style="width: 70%;">

          <label for="simParams">End Time</label>
          <input type="text" id="simParams" class="settings-input" placeholder="Enter end time..." value="10" style="width: 70%;">

          <label for="simParams">dt (Time Increment)</label>
          <input type="text" id="simParams" class="settings-input" placeholder="Enter dt..." value="0.1" style="width: 50%;">

          <label for="themeSelect">Integration Method</label>
          <select id="themeSelect" class="settings-dropdown" style="width: 50%;">
            <option>Runge-Kutta 4</option>
            <option>Euler</option>
          </select>

          <label class="switch-label">
          <span>Enable High Step Count Simulations</span>
            <label class="toggle-switch">
              <input type="checkbox">
              <span class="slider"></span>
            </label>
          </label>

        </div>
        <hr class="settings-divider">

        <div class="setting-group">
          <label for="themeSelect">Theme</label>
          <select id="themeSelect" class="settings-dropdown" style="width: 80%;">
            <option>Normal</option>
            <option>Light</option>
            <option>Dark</option>
          </select>
        </div>
        <button class="setting-button" onclick="closeSettings()">Apply Settings</button>

      </div>

      <div id="charts-popup" class="charts-popup hidden">
        <div class="settings-header">
          <h2>Edit Chart/Table</h2>
          <button class="close-btn" onclick="closeSettings()"><i class="fa-regular fa-xmark"></i></button>
        </div>
        <div class="setting-group">
          <label for="chartSelect">Type:</label>
          <select id="chartSelect" class="settings-dropdown" style="width: 75%;">
            <option>Chart</option>
            <option>Table</option>
          </select>
        </div>
        <hr class="settings-divider">

        <div class="setting-group">
          <label for="xaxisSelect">X-Axis:</label>
          <select id="xaxisSelect" class="settings-dropdown" style="width: 75%;">
            <option>Time</option>
            <option>Stock1</option>
            <option>Stock2</option>
          </select>
        </div>

        <hr class="settings-divider">

        <div class="setting-group">
          <span>Y-Axis:</span>
          <label class="switch-label">
            <span>Stock1</span>
            <label class="toggle-switch">
              <input type="checkbox">
              <span class="slider"></span>
            </label>
          </label>

          <label class="switch-label">
            <span>Stock2</span>
            <label class="toggle-switch">
              <input type="checkbox">
              <span class="slider"></span>
            </label>
          </label>

          <label class="switch-label">
            <span>Stock3</span>
            <label class="toggle-switch">
              <input type="checkbox">
              <span class="slider"></span>
            </label>
          </label>
        </div>
        <button class="setting-button">Create Table/Chart</button>
      </div>

      <div id="equationEditorOverlay" class="equation-editor-overlay" onclick="closePopup()"></div>
      <div id="equationEditorPopup" class="equation-editor-popup">
        <div class="equation-editor-popup-content">
          <div class="equation-editor-popup-header">
            <p class="equation-editor-title">Equation Editor</p>
            <i class="fa-regular fa-xmark close-icon" onclick="closePopup()"></i>
          </div>
          <div id="equationEditorPopupContent"></div>
        </div>
      </div>


      </div>
    </div>
<script>
  // ================== Opening the settings popup ==================
  const popup = document.getElementById("settingsPopup");
  const overlay = document.getElementById("overlay");
  const openBtn = document.getElementById("openSettingsBtn");
  const openBtn2 = document.getElementById("openSettingsBtn2");

  // Function to open the popup with transition
  function openSettings(event) {
    event.preventDefault();
    popup.classList.remove("hidden");
    overlay.classList.remove("hidden");

    // Trigger transition on next frame
    requestAnimationFrame(() => {
      popup.classList.add("show");
      overlay.classList.add("show");
    });
  }

  // Function to close the popup with transition
  function closeSettings() {
    popup.classList.remove("show");
    overlay.classList.remove("show");

    // After transition ends, hide elements
    setTimeout(() => {
      popup.classList.add("hidden");
      overlay.classList.add("hidden");
    }, 300); // duration matches CSS transition
  } //charts-popup

  // Open popup on button click
  openBtn.addEventListener("click", openSettings);
  openBtn2.addEventListener("click", openSettings);

  // Close popup when clicking on overlay
  overlay.addEventListener("click", () => {
    closeSettings();
    closePopup();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && !popup.classList.contains("hidden")) {
      closeSettings();
    }
  });

  // ================== Switching between tabs ==================
  document.addEventListener("DOMContentLoaded", () => {
    const modelViewer = document.querySelector('.modelViewer');
    const chartViewer = document.querySelector('.chartViewer');
    const modelBtn = document.getElementById('modelBtn');
    const chartBtn = document.getElementById('chartBtn');

    // Initial state: show modelViewer, hide chartViewer, modelBtn active
    modelViewer.classList.remove('hidden');
    chartViewer.classList.add('hidden');
    modelBtn.classList.add('active');

    function showViewer(viewerToShow, viewerToHide) {
      viewerToHide.classList.add('fade-out');
      viewerToShow.classList.remove('hidden');
      viewerToShow.classList.add('fade-in');

      setTimeout(() => {
        viewerToHide.classList.add('hidden');
        viewerToHide.classList.remove('fade-out');
        viewerToShow.classList.remove('fade-in');
      }, 300); // match the CSS transition duration
    }

    function activateModelView() {
      if (modelViewer.classList.contains('hidden')) {
        showViewer(modelViewer, chartViewer);
        modelBtn.classList.add('active');
        chartBtn.classList.remove('active');
      }
    }

    function activateChartView() {
      if (chartViewer.classList.contains('hidden')) {
        showViewer(chartViewer, modelViewer);
        chartBtn.classList.add('active');
        modelBtn.classList.remove('active');
      }
    }

    modelBtn.addEventListener('click', (e) => {
      e.preventDefault();
      activateModelView();
    });

    chartBtn.addEventListener('click', (e) => {
      e.preventDefault();
      activateChartView();
    });
  });

  // ================== Tooltips ==================
  document.addEventListener('DOMContentLoaded', () => {
    // Select all toolbar and chartSidebar buttons except those with 'no-active' class
    const buttons = document.querySelectorAll('.toolbar a:not(.no-active), .chartSidebar a:not(.no-active)');

    buttons.forEach(button => {
      // Click toggles active mode
      button.addEventListener('click', (e) => {
        e.preventDefault(); // prevent link default behavior on mode buttons
        // Remove active class from all buttons
        buttons.forEach(btn => btn.classList.remove('active'));
        // Add active class to clicked button
        button.classList.add('active');

        // Hide tooltip immediately on click
        const tooltip = button.querySelector('span');
        if (tooltip) {
          tooltip.style.transform = 'scale(0)';
          tooltip.style.opacity = '0';
        }
      });

      // Show tooltip on hover only if NOT active
      button.addEventListener('mouseenter', () => {
        if (!button.classList.contains('active')) {
          const tooltip = button.querySelector('span');
          if (tooltip) {
            tooltip.style.transform = 'scale(1)';
            tooltip.style.opacity = '1';
          }
        }
      });

      // Hide tooltip on mouse leave only if NOT active
      button.addEventListener('mouseleave', () => {
        if (!button.classList.contains('active')) {
          const tooltip = button.querySelector('span');
          if (tooltip) {
            tooltip.style.transform = 'scale(0)';
            tooltip.style.opacity = '0';
          }
        }
      });
    });

    // Help/settings buttons with 'no-active' class behave normally (no JS needed)
  });

  // ================== Opening the equation editor popup screen ==================
  function openEquationEditorPopup() {
    const table = document.querySelector(".equation-editor-table");
    const popup = document.getElementById("equationEditorPopup");
    const overlay = document.getElementById("equationEditorOverlay");
    const popupContent = document.getElementById("equationEditorPopupContent");

    popupContent.innerHTML = "";
    popupContent.appendChild(table.cloneNode(true));

    popup.classList.remove("fade-out");
    overlay.classList.remove("fade-out");

    popup.style.display = "block";
    overlay.style.display = "block";

    popup.classList.add("fade-in");
    overlay.classList.add("fade-in");
  }

  function closePopup() {
    // Sync before starting to close
    syncEquationEditors();

    const popup = document.getElementById("equationEditorPopup");
    const overlay = document.getElementById("equationEditorOverlay");

    popup.classList.remove("fade-in");
    overlay.classList.remove("fade-in");

    popup.classList.add("fade-out");
    overlay.classList.add("fade-out");

    setTimeout(() => {
      popup.style.display = "none";
      overlay.style.display = "none";
      popup.classList.remove("fade-out");
      overlay.classList.remove("fade-out");
    }, 300);
  }

  function syncEquationEditors() {
    const popupRows = document.querySelectorAll('#equationEditorPopupContent tbody tr');
    const mainRows = document.querySelectorAll('.equation-editor-table tbody tr');

    popupRows.forEach((popupRow, index) => {
      const popupInputs = popupRow.querySelectorAll('input');
      const mainInputs = mainRows[index].querySelectorAll('input');

      popupInputs.forEach((popupInput, i) => {
        if (popupInput.type === 'checkbox') {
          mainInputs[i].checked = popupInput.checked;
        } else {
          mainInputs[i].value = popupInput.value;
        }
      });
    });
  }

  // ================== When you click on image it goes to home page ==================
  document.getElementById('logoImage').addEventListener('click', function () {
    window.location.href = '../landing/homePage1.html';
  });
</script>






</body>


</html>





